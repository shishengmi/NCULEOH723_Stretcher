#include "Filtering.h"

uint32_t blockSize = Block_Size;
uint32_t numBlocks = Samples_Number/Block_Size;
float32_t firState2[Block_Size + NumTaps - 1];

arm_fir_instance_f32 ADS1292;




const float32_t BPF_5Hz_40Hz[NumTaps] = {
    3.523997657e-05f, 0.0002562592272f, 0.0005757701583f, 0.0008397826459f, 0.000908970891f,
    0.0007304374012f, 0.0003793779761f, 4.222582356e-05f, -6.521392788e-05f, 0.0001839015895f,
    0.0007320778677f, 0.001328663086f, 0.001635892317f, 0.001413777587f, 0.0006883906899f,
    -0.0002056905651f, -0.0007648666506f, -0.0005919140531f, 0.0003351111372f, 0.001569915912f,
    0.002375603188f, 0.002117323689f, 0.0006689901347f, -0.001414557919f, -0.003109993879f,
    -0.003462586319f, -0.00217742566f, 8.629632794e-05f, 0.001947802957f, 0.002011778764f,
    -0.0002987752669f, -0.004264956806f, -0.00809297245f, -0.009811084718f, -0.008411717601f,
    -0.004596390296f, -0.0006214127061f, 0.0007985962438f, -0.001978532877f, -0.008395017125f,
    -0.01568987407f, -0.02018531598f, -0.01929843985f, -0.01321159769f, -0.005181713495f,
    -0.0001112028476f, -0.001950757345f, -0.01125541423f, -0.0243169684f, -0.03460548073f,
    -0.03605531529f, -0.02662901953f, -0.01020727865f, 0.004513713531f, 0.008002913557f,
    -0.004921500571f, -0.03125274926f, -0.05950148031f, -0.07363011688f, -0.05986980721f,
    -0.01351031102f, 0.05752891302f, 0.1343045086f, 0.1933406889f, 0.2154731899f,
    0.1933406889f, 0.1343045086f, 0.05752891302f, -0.01351031102f, -0.05986980721f,
    -0.07363011688f, -0.05950148031f, -0.03125274926f, -0.004921500571f, 0.008002913557f,
    0.004513713531f, -0.01020727865f, -0.02662901953f, -0.03605531529f, -0.03460548073f,
    -0.0243169684f, -0.01125541423f, -0.001950757345f, -0.0001112028476f, -0.005181713495f,
    -0.01321159769f, -0.01929843985f, -0.02018531598f, -0.01568987407f, -0.008395017125f,
    -0.001978532877f, 0.0007985962438f, -0.0006214127061f, -0.004596390296f, -0.008411717601f,
    -0.009811084718f, -0.00809297245f, -0.004264956806f, -0.0002987752669f, 0.002011778764f,
    0.001947802957f, 8.629632794e-05f, -0.00217742566f, -0.003462586319f, -0.003109993879f,
    -0.001414557919f, 0.0006689901347f, 0.002117323689f, 0.002375603188f, 0.001569915912f,
    0.0003351111372f, -0.0005919140531f, -0.0007648666506f, -0.0002056905651f, 0.0006883906899f,
    0.001413777587f, 0.001635892317f, 0.001328663086f, 0.0007320778677f, 0.0001839015895f,
    -6.521392788e-05f, 4.222582356e-05f, 0.0003793779761f, 0.0007304374012f, 0.000908970891f,
    0.0008397826459f, 0.0005757701583f, 0.0002562592272f, 3.523997657e-05f
};

void Filtering_Init(void)
{
  arm_fir_init_f32(&ADS1292, NumTaps, (float32_t *)BPF_5Hz_40Hz, firState2, blockSize);
}


void Filtering(float32_t * Input_data,float32_t * Output_data)
{
  arm_fir_init_f32(&ADS1292, NumTaps, (float32_t *)BPF_5Hz_40Hz, firState2, blockSize);
  arm_fir_f32(&ADS1292, Input_data, Output_data, blockSize);
}
